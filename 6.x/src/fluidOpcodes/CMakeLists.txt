option(BUILD_FLUID_OPCODES "Build the fluidsynth opcodes" OFF)

if(USE_VCPKG)
    find_package(FluidSynth CONFIG)

    if(NOT TARGET FluidSynth::libfluidsynth)
        message(STATUS "Could not find FluidSynth::libfluidsynth")
        set(BUILD_FLUID_OPCODES OFF)
    endif()
else()
    find_package(FLUIDSYNTH)
    check_deps(BUILD_FLUID_OPCODES FLUIDSYNTH_FOUND)
endif()

if(BUILD_FLUID_OPCODES)
    make_plugin(fluidOpcodes "6x" fluidOpcodes.cpp)

    if(USE_VCPKG)
        target_link_libraries(fluidOpcodes PRIVATE FluidSynth::libfluidsynth)
    else()
        target_include_directories(fluidOpcodes PRIVATE ${FLUIDSYNTH_INCLUDE_DIR})
        target_link_libraries(fluidOpcodes ${FLUIDSYNTH_LIBRARIES})
    endif()

    message(STATUS "Building Fluid opcodes")
endif()
